
<!-- this should all be moved to application.html -->

<script src="//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry" type="text/javascript"></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>


<h1>Listing users</h1>
<% if user_signed_in? %>
  Welcome back <%= current_user.name %>
  <%= link_to("Settings", edit_user_registration_path) %>
  <%= link_to("Sign out", destroy_user_session_path, :method => :delete) %>
<% else %>
  <%= link_to("Sign up", new_user_registration_path) %>
  <%= link_to("Sign in", new_user_session_path) %>
<% end %>

<!-- this is for twitter bootstrap's grid system -->
<div class="container">
<table>
  <thead>
    <tr>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Address</th>
      <th>Name</th>
      <th>Password</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Website</th>
      <th>Facebook</th>
      <th>Logo</th>
      <th>Type</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @users.each do |user| %>
      <tr>
        <td><%= user.latitude %></td>
        <td><%= user.longitude %></td>
        <td><%= user.address %></td>
        <td><%= user.name %></td>
        <td><%= user.password %></td>
        <td><%= user.email %></td>
        <td><%= user.phone %></td>
        <td><%= user.website %></td>
        <td><%= user.facebook %></td>
        <td><%= user.logo %></td>
        <td><%= user.class_type %></td>
        <td><%= link_to 'Show', user %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<!-- <%= link_to 'New User', new_user_path %> -->

<div style='width: 1200px;'>
  <div id="basic_map" style='width: 1200px; height: 800px;'></div>
</div>

<script type="text/javascript">

var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'basic_map'}}, function(){
  var markers = handler.addMarkers([
    <% @users.each do |user| %>
      <% if !user.address.blank? %> <!-- only appears in map if address given -->
        <% if @users.at(-1) == user %>
          {
            lat:<%= user.latitude %>, 
            lng: <%= user.longitude %>, 
            //picture: {
           //   url: "https://addons.cdn.mozilla.net/img/uploads/addon_icons/13/13028-64.png",
             // width:  36,
             // height: 36
            //},
            infowindow: "<%= user.name%><br><%= user.address %><br><%=user.email %><br><%= user.phone %>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque ut mattis ligula, sit amet tempus justo. Donec id consequat risus. Sed malesuada tristique arcu, vitae consequat massa. Sed ut lacus enim. Integer pellentesque quis dui nec efficitur. Praesent et finibus metus. Mauris non vulputate nisi, eget tempor diam. Duis laoreet sapien id nunc rhoncus, ut aliquet felis vulputate. Donec in est consequat, pulvinar eros sit amet, ultrices leo."
          }
        <% else %>
          {
            lat:<%= user.latitude %>, 
            lng: <%= user.longitude %>,
            // picture: {
            //   url: "https://addons.cdn.mozilla.net/img/uploads/addon_icons/13/13028-64.png",
            //   width:  36,
            //   height: 36
            // },
             infowindow: "<%= user.name%><br><%= user.address %><br><%=user.email %><br><%= user.phone %>"
          },
        <% end %>
        <% end %>
    <% end %>
  ]);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});
</script>

</div>
